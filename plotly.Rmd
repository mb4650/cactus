---
title: "Plotly Graphics"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
runtime: shiny
---

```{r setup,include=FALSE}
library(tidyverse)
library(COVID19)
library(flexdashboard)
library(plotly)
```

```{r}
#level = 2 gives state level data and raw = false cleans the dataset
covid_dataset = covid19(c("US"), level = 2, raw = FALSE) %>%
                janitor::clean_names() %>%
                filter(date <= '2020-10-31')

noaa = read_csv("data/noaadata.csv")%>%
        select (-c(X1))%>%
        janitor::clean_names()

noaa_avg = noaa %>%
  mutate(
    tavg = tavg/10,
    tmax = tmax/10,
    tmin = tmin/10,
  ) %>%
  group_by(state, date) %>%
  summarize(
    state_tavg = mean(tavg),
    state_tmax = mean(tmax),
    state_tmin = mean(tmin),
    state_prcp = mean(prcp)
  )
  

covid_noaa_dataset = full_join(covid_dataset,noaa_avg, by = c("key_alpha_2" = "state", "date" = "date")) 

plot_df = 
  covid_noaa_dataset %>%
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>%
  select(id:population, key_apple_mobility, key_alpha_2, state_tavg:state_prcp) %>%
  mutate(
    prop_cases = confirmed/population,
    prop_deaths_pop = deaths/population,
    prop_deaths_case = deaths/confirmed,
    prop_hospital_pop = hosp/population,
    prop_hospital_case = hosp/confirmed,
    prop_tested = tests/population
  ) %>%
  group_by(key_alpha_2) %>%
  mutate(new_cases = (confirmed - lag(confirmed)))
  
```



Column {.sidebar}
-----------------------------------------------------------------------


```{r}

# State list
state_sel = plot_df %>% pull(key_apple_mobility) %>% unique() %>% sort()


# Select state 
selectInput("state_sel", 
            label = h3("Select state"),
						choices = state_sel,
						selected = "Alabama")


```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}

```

### Chart C

```{r}

```

Trends in COVID and Climate in US Between Jan 2020 and Oct 2020
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------


```{r}

# Select State, Month, Day
var_choice = plot_df %>% names() 
var_sel = as.data.frame(var_choice) %>% filter(var_choice %in% c("tests", "confirmed", "deaths", "hosp", "population", "state_tavg", "state_tmax", "state_tmin", "state_prcp", "prop_cases", "prop_deaths_pop", "prop_deaths_case", "prop_hospital_pop", "prop_hospital_case", "prop_tested", "new_cases"))
month = month.name
day = c(1:31)

# Select month 
selectInput("month_sel", 
            label = h3("Select month"),
						choices = as.list(month),
						selected = "January")

# Select dat
selectInput("day_sel", 
            label = h3("Select day"),
						choices = as.list(day),
						selected = 1)

# Variable select
selectInput("variable_sel", label = h3("Select variable"),
						choices = var_sel, selected = "confirmed")
```


